@using FamTec.Shared.Client.DTO
@inject IJSRuntime JSRuntime

<div class="table-container">
    <div class="table-body">
        <table class="table">
            <thead class="thead">
                <tr class="thead-tr tr">
                    @foreach(string property in Properties)
                    {   
                        <th class="thead-th">@property</th>
                    }
                    
                </tr>
            </thead>
            <tbody class="tbody">
                @foreach (var row in DataList)
                {
                    <tr class="tbody-tr tr">
                        @foreach(var property in typeof(PlaceDTO).GetProperties())
                        {
                            
                            if(property.Name != "IsSelect")
                            {
                                <td class="tbody-td">
                                    @row.GetType().GetProperty(property.Name)?.GetValue(row)
                                </td>
                            }
                            else
                            {
                                <td class="tbody-td">
                                    <input type="checkbox" value="@row" @onchange="()=>InvokeCheckboxSelect(row)" />
                                </td>
                            }
                        }
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@code {
    [Parameter] public string? Title { get; set; }
    [Parameter] public List<PlaceDTO>? DataList { get; set; }
    [Parameter] public List<string>? Properties { get; set; }
    [Parameter] public EventCallback<object> Select { get; set; }
    [Parameter] public EventCallback<object> UnSelect { get; set; }


    protected override async Task OnInitializedAsync()
    {
        return;
    }

    private void OnClicked(object row)
    {
        Console.WriteLine(row);
    }


    private async Task InvokeCheckboxSelect(object row)
    {
        try
        {
            var property = row.GetType().GetProperty("IsSelect");
            if (property != null)
            {
                bool currentValue = (bool)property.GetValue(row);
                property.SetValue(row, !currentValue);

                if ((bool)row.GetType().GetProperty("IsSelect").GetValue(row))
                {
                    Console.WriteLine("선택됨");
                    //transfer Object to Paraent
                    await Select.InvokeAsync(row);
                }
                else
                {
                    Console.WriteLine("해제됨");
                    await UnSelect.InvokeAsync(row);
                }
            }
        }catch(Exception e)
        {
            Console.WriteLine($"[table][{Title}] InvokeCheckboxSelect 함수 에러  \n" + e);
        }
        
    }
}
